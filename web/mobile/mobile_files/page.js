(function($,AppConfig,LC){if(!AppConfig){return;}var _AppConfig,_BaseUrl;_AppConfig=$.extend({},AppConfig);_BaseUrl=LC.BaseUrl;var UI={};UI.EVENTS={};(function(ev){var hastouch;hastouch=ev.hastouch=((window.DocumentTouch&&document instanceof window.DocumentTouch)||"ontouchstart" in window);ev.touchstart=hastouch?"touchstart":"mousedown";ev.touchmove=hastouch?"touchmove":"mousemove";ev.touchend=hastouch?"touchend":"mouseup";ev.resize="onorientationchange" in window?"orientationchange":"resize";})(UI.EVENTS);UI.Slide=(function(window,undefined){var pattern=/translate3d\((-?\d+)(px)?,\s?0(px)?,\s?0(px)?\)/;function empty(){}function trigger(target,type){event=document.createEvent("Events"),event.initEvent(type,false,true);target.dispatchEvent(event);}function initevent(slide,list,scrollY){var x,y,dx,t;list.addEventListener("touchstart",function(event){x=event.touches[0].clientX;y=event.touches[0].clientY;});list.addEventListener("touchmove",function(event){if(x!=undefined){var ax=event.touches[0].clientX-x;var ay=event.touches[0].clientY-y;if(Math.abs(ax/ay)>1){dx=ax;}else{if(scrollY==true){return;}}event.preventDefault();return false;}});function endAction(event){if(dx!=undefined){if(dx>0){slide.index=Math.max(slide.index-1,0);}else{if(dx<0){slide.index=Math.min(slide.index+1,slide.length-1);}}x=y=dx=dy=undefined;move(slide);event.preventDefault();return false;}}list.addEventListener("touchend",endAction);list.addEventListener("touchcancel",endAction);list.addEventListener("webkitTransitionEnd",function(){trigger(window,"viewchange");});function resize(event){t&&clearTimeout(t);t=setTimeout(function(){move(slide,true);t=undefined;},500);}window.addEventListener("orientationchange",resize);window.addEventListener("resize",resize);}function init(slide){var list=slide.list,parent=list.parentElement,viewRect=parent.getBoundingClientRect();if(viewRect.width){var offset=slide.offset={viewWidth:viewRect.width};var trans=pattern.test(list.style["webkitTransform"])?parseInt(RegExp.$1):0;var rect0=list.children[0].children[0].getBoundingClientRect();var rectz=list.children[slide.length-1].children[0].getBoundingClientRect();var left=rect0.left,right=rectz.right,width=rect0.width;offset.totalWidth=right-left+(left-viewRect.left-trans)*2;offset.step=slide.length==1?width:(right-left-width)/(slide.length-1);slide["moveable"]=slide.length>0&&offset.totalWidth>offset.viewWidth;if(!slide["moveable"]){list.style["webkitTransform"]="";}}}function move(slide,needinit){if(needinit||slide["moveable"]==undefined){init(slide);}if(slide["moveable"]){var offset=slide.offset,list=slide.list;var transfer=pattern.test(list.style["webkitTransform"])?parseInt(RegExp.$1):0;var trans=Math.max(0,Math.min(offset.step*slide.index,offset.totalWidth-offset.viewWidth));if(Math.abs(transfer+trans)>3){list.style["webkitTransform"]="translate3d(-"+trans+"px,0,0)";}else{slide.index=Math.ceil(trans/offset.step);}slide.callback(slide.index,offset.totalWidth,offset.viewWidth,trans);}}function reset(slide,whole){if(whole!=false){slide.index=0;}move(slide);}var wrap=function(list,callback,scrollY){var slide=this;slide.list=list;slide.index=0;slide.callback=callback||empty;slide.length=list.childElementCount;initevent(slide,list,scrollY);move(slide);};wrap.prototype={constructor:wrap,reset:function(whole){var slide=this;whole!=false&&(slide.index=0,slide.length=slide.list.childElementCount);move(slide,true);},jump:function(i){var slide=this,list=slide.list;slide.index=Math.max(Math.min(i,slide.length-1),0);list.style["webkitTransition"]="-webkit-transform 0ms";move(slide);setTimeout(function(){list.style["webkitTransition"]="";trigger(window,"viewchange");},0);}};return wrap;})(window);function bindToggleActive(){$(".btn-toggle-active").unbind(UI.EVENTS.touchstart).bind(UI.EVENTS.touchstart,function(e){var $btn,$obj;$btn=$(e.target);$obj=$($btn.attr("toggle-for"));if(!$obj.length){return;}$btn.addClass("icon-extension-touch");$obj.toggleClass("active");setTimeout(function(){$btn.removeClass("icon-extension-touch");},300);if($btn.hasClass("icon-extension-up")){$btn.removeClass("icon-extension-up").addClass("icon-extension-down");return;}if($btn.hasClass("icon-extension-down")){$btn.removeClass("icon-extension-down").addClass("icon-extension-up");return;}});}function initImgSlide(){var $imgBox=$(".mod-detail-slide");var $imgBar=$imgBox.find(".mod-scroll-bar .scroll");$imgList=$imgBox.children("ul");new UI.Slide($imgList[0],function(index,total,view,trans){var width=Math.floor(view*100/total)+"%";var transform="translate3d("+Math.round(trans*100/view)+"%,0,0)";$imgBar.css({"width":width,"transform":transform,"-webkit-transform":transform});},true);}function getComments(){var data={};data.appid=_AppConfig.appId;data.size=8;data.r=Math.random();$.ajax({url:_BaseUrl+"/ajax/massist/detail/AppComment",data:data,success:function(result){var comments;if(result&&result.ret==0){try{comments=result.data.commentList||[];}catch(e){comments=[];}$("#comment-info ul").html(ejs.render($("#tpl-comment").html(),{comments:comments}));if(comments.length>2){$("#comment-info .btn-more-comment").bind(UI.EVENTS.touchstart,function(ev){ev.stopPropagation();ev.preventDefault();$("#comment-info li").show();$(ev.target).hide();}).show();}$("#comment-info").show();}}});}function init(){bindToggleActive();initImgSlide();}$(function(){init();});})($,window.APPCONFIG,window.LC);